<!DOCTYPE html>
<html lang="pt-br" data-theme="light">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/global.css"> 
    <link rel="stylesheet" href="/css/styleGenerico.css" />
    <link rel="stylesheet" href="/css/searchbar.css" />
    <link rel="stylesheet" href="/css/hospitais.css" />
    <title>Saúde Access</title>
    <link rel="stylesheet" href="/css/protected.css" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/global.js"></script>
    <script src="js/auth-utils.js" defer></script>
    <link rel="icon" type="image/x-icon" href="/favorite.ico">
</head> 
<body class="protected">
    <header>
        <h1><%= titulo %></h1>
    </header>
    <main>
        <form action="#" class="form-busca-hospital">
            <input
                type="search"
                name="pesquisar-hospitais"
                class="inp-busca-hospital"
                placeholder="Pesquisar hospital"
                autocomplete="off"
            />
            <button type="submit" class="btn-busca-hospital" aria-label="Pesquisar">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="32"
                    height="32"
                    fill="currentColor"
                    viewBox="0 0 256 256"
                >
                    <path
                        d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"
                    ></path>
                </svg>
            </button>
        </form>
        <div id="search-results-container"></div>
        <div class="container-hospitais">
            <div class="div-butoes">
                <% hospitais.forEach(hospital => { %>
    <%
        // ... (sua lógica de nota_bruta, nota_limpa, etc. continua aqui) ...
        const nota_bruta = Number(hospital.nota) || 0;
        const nota_limpa = parseFloat(nota_bruta.toFixed(2));
        const nota_texto = (Math.floor(nota_limpa * 10) / 10).toFixed(1);
        const nota_classe = Math.floor(nota_limpa);
    %>
    <a href="/hospital?id=<%= hospital.id %>" class="botao-hospital">
        <span class="botao-hospital-nota rating-<%= nota_classe %>"><%= nota_texto %></span>
        
        <div class="botao-hospital-info">
            <span class="botao-hospital-nome"><%= hospital.nome %></span>
            
            <% if (hospital.distancia) { %>
                <span class="botao-hospital-distancia">
                    <%= hospital.distancia %>
                </span>
            <% } %>
        </div>
    </a>
<% }) %>
            </div>
        </div>
    </main>
    <%- include ('partials/navbar.ejs') %>
    <script src="/js/searchbar.js"></script>
</body>
</html>
