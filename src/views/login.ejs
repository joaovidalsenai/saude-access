<!DOCTYPE html>
<html lang="pt-br" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/styleGenerico.css">
    <link rel="stylesheet" href="/css/login.css">
    <title><%= title || "Saúde Access" %></title>
</head>
<body>
    <header>       
        <h1><%= heading || "Login" %></h1>
    </header>
    <main>
        <div class="login-container">
            <div class="login-section">
                <form id="formLogin" method="POST" action="/api/login">
                    <div class="login-item">
                        <div class="login-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 256 256">
                                <path d="M230.92,212c-15.23-26.33-38.7-45.21-66.09-54.16a72,72,0,1,0-73.66,0C63.78,166.78,40.31,185.66,25.08,212a8,8,0,1,0,13.85,8c18.84-32.56,52.14-52,89.07-52s70.23,19.44,89.07,52a8,8,0,1,0,13.85-8ZM72,96a56,56,0,1,1,56,56A56.06,56.06,0,0,1,72,96Z"></path>
                            </svg>
                        </div>
                        <div class="input-group">
                            <label for="login-email" class="label-login">CPF ou E-mail</label>
                            <input type="email" id="login-email" name="email" placeholder="Digite seu E-mail" class="input-login" required>
                        </div>
                    </div>
                    
                    <div class="login-item">
                        <div class="login-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 256 256">
                                <path d="M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96ZM208,208H48V96H208V208Z"></path>
                            </svg>
                        </div>
                        <div class="input-group">
                            <label for="login-senha" class="label-login">Senha</label>
                            <input type="password" id="login-senha" name="password" placeholder="Digite sua senha" class="input-login" required>
                        </div>
                    </div>
                    
                    <div class="login-opcoes">
                        <div class="checkbox-container">
                            <input type="checkbox" id="lembrar-login" class="config-checkbox">
                            <label for="lembrar-login" class="config-checkbox-label">Lembrar-me</label>
                        </div>
                        <a href="recuperarSenha.html" class="esqueci-senha">Esqueci minha senha</a>
                    </div>
                    
                    <button type="submit" class="btn-entrar">
                        Entrar
                    </button>
                </form>

                <% if (typeof error !== "undefined") { %>
                    <p id="msg" style="color:red; margin-top:10px;"><%= error %></p>
                <% } %>

                <div class="login-cadastro">
                    <p>Não tem uma conta?</p>
                    <a href="/cadastro" class="btn-cadastro">Cadastre-se</a>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.getElementById("formLogin").addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = document.getElementById("login-email").value;
            const password = document.getElementById("login-senha").value;

            try {
                const res = await fetch("/api/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });

                const data = await res.json();
                if (res.ok) {
                    window.location.href = "/inicio";
                } else {
                    document.getElementById("msg").innerText = data.error || "Falha no login.";
                }
            } catch (err) {
                document.getElementById("msg").innerText = "Erro ao conectar ao servidor.";
            }
        });
    </script>
</body>
</html>
